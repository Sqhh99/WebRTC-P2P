# NetherLink-server ğŸš€

NetherLink-server æ˜¯ä¸€ä¸ªåŸºäº Go è¯­è¨€å¼€å‘çš„å³æ—¶é€šè®¯æœåŠ¡å™¨ï¼Œæä¾›ç”¨æˆ·ç®¡ç†ã€å³æ—¶é€šè®¯ã€ç¤¾äº¤åŠ¨æ€ã€ç¦»çº¿æ¶ˆæ¯åŒæ­¥ç­‰åŠŸèƒ½ã€‚

## âœ¨ ä¸»è¦åŠŸèƒ½

1. ğŸ‘¤ ç”¨æˆ·ç³»ç»Ÿ
   - ğŸ“§ é‚®ç®±éªŒè¯ç æ³¨å†Œ
   - ğŸ” è´¦å·å¯†ç ç™»å½•
   - ğŸ« JWT èº«ä»½è®¤è¯

2. ğŸ’¬ å³æ—¶é€šè®¯
   - ğŸ”Œ WebSocket å®æ—¶é€šè®¯
   - ğŸ“¨ ç§èŠæ¶ˆæ¯
   - ğŸ‘¥ ç¾¤èŠåŠŸèƒ½
   - ğŸ‘¬ å¥½å‹ç³»ç»Ÿ
   - ğŸŸ¢ åœ¨çº¿çŠ¶æ€ç®¡ç†

3. ï¿½ ç¦»çº¿æ¶ˆæ¯ç³»ç»Ÿï¼ˆæ–°å¢ï¼‰
   - ğŸ’¾ ç¦»çº¿æ¶ˆæ¯æŒä¹…åŒ–
   - ğŸ”„ ç™»å½•åè‡ªåŠ¨åŒæ­¥
   - ğŸ“Š æœªè¯»æ¶ˆæ¯ç»Ÿè®¡
   - âœ… æ¶ˆæ¯å·²è¯»æ ‡è®°
   - ï¿½ğŸ“± æ¨é€é€šçŸ¥ï¼ˆAPNs/FCM/é‚®ä»¶ï¼‰

4. ğŸ“± ç¤¾äº¤åŠ¨æ€
   - ğŸ“ å‘å¸ƒåŠ¨æ€ï¼ˆæ”¯æŒæ–‡å­—å’Œå›¾ç‰‡ï¼‰
   - ğŸ’­ è¯„è®ºåŠŸèƒ½
   - â¤ï¸ ç‚¹èµåŠŸèƒ½

5. ğŸ¤– AI å¯¹è¯
   - ğŸ§  åŸºäº Gemini API çš„æ™ºèƒ½å¯¹è¯
   - ğŸ“š å¯¹è¯å†å²è®°å½•
   - âš¡ æµå¼å“åº”

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- ğŸ¹ Go
- ğŸ¸ Gin (Web æ¡†æ¶)
- ğŸ—ƒï¸ GORM (ORM æ¡†æ¶)
- ğŸ”Œ WebSocket
- ğŸ¬ MySQL (æ¶ˆæ¯æŒä¹…åŒ–)
- ğŸ° RabbitMQ (æ¶ˆæ¯é˜Ÿåˆ—)
- ğŸ“® Redis (åœ¨çº¿çŠ¶æ€ç¼“å­˜)
- ğŸ« JWT (èº«ä»½è®¤è¯)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. é…ç½®æ•°æ®åº“ ğŸ“Š

1. åˆ›å»º MySQL æ•°æ®åº“
```mysql
CREATE DATABASE netherlink;
```

2. å¯¼å…¥æ•°æ®åº“ç»“æ„
```mysql
use netherlink;
source netherlink.sql;
source migrations/001_add_message_queue_tables.sql;
```

> ğŸ’¡ **æç¤ºï¼š** ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­çš„ \`create_sql.txt\` æ–‡ä»¶æ‰‹åŠ¨åˆ›å»ºè¡¨ç»“æ„ï¼Œè¯¥æ–‡ä»¶åŒ…å«äº†å®Œæ•´çš„å»ºè¡¨è¯­å¥ï¼Œé€‚ç”¨äºæœªä½¿ç”¨ \`netherlink.sql\` çš„åœºæ™¯ã€‚
### 2. ä¿®æ”¹é…ç½®æ–‡ä»¶ âš™ï¸

é…ç½®æ–‡ä»¶ä½äº `config/config.yaml`ï¼Œéœ€è¦ä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š

1. æœåŠ¡å™¨é…ç½®
```yaml
server:
  http:
    base_url: http://your-domain:8080  # ä¿®æ”¹ä¸ºä½ çš„æœåŠ¡å™¨åœ°å€
```

2. æ•°æ®åº“é…ç½®
```yaml
database:
  host: localhost     # æ•°æ®åº“åœ°å€
  port: 3306         # æ•°æ®åº“ç«¯å£
  username: root     # æ•°æ®åº“ç”¨æˆ·å
  password: 123456   # æ•°æ®åº“å¯†ç 
  dbname: netherlink # æ•°æ®åº“åç§°
```

3. JWT é…ç½®
```yaml
jwt:
  secret: your-jwt-secret  # ä¿®æ”¹ä¸ºè‡ªå®šä¹‰çš„ JWT å¯†é’¥
```

4. AI é…ç½®ï¼ˆå¦‚æœéœ€è¦ AI å¯¹è¯åŠŸèƒ½ï¼‰
```yaml
ai:
  api_key: your-deepseek-api-key  # æ›¿æ¢ä¸ºä½ çš„ Deepseek API å¯†é’¥
```

5. é‚®ç®±é…ç½®ï¼ˆç”¨äºå‘é€éªŒè¯ç ï¼‰
```yaml
email:
  smtp_host: smtp.qq.com          # SMTP æœåŠ¡å™¨åœ°å€
  smtp_port: 465                  # SMTP ç«¯å£
  sender: "your-email@qq.com"     # å‘ä»¶äººé‚®ç®±
  password: "your-email-password" # é‚®ç®±æˆæƒç 
```

### 3. è¿è¡ŒæœåŠ¡å™¨ ğŸš€

```bash
go mod tidy
go run main.go
```

### 4. å®¢æˆ·ç«¯ä»“åº“åœ°å€ ğŸŒ

- å®¢æˆ·ç«¯ä»£ç ä»“åº“ï¼š[NetherLink](https://github.com/ming0725/NetherLink)

- æŒ‰ç…§å®¢æˆ·ç«¯ä»“åº“çš„è¯´æ˜è¿›è¡Œéƒ¨ç½²

## ğŸ“š API æ–‡æ¡£

### ğŸ‘¤ ç”¨æˆ·ç›¸å…³

1. å‘é€éªŒè¯ç 
- POST `/api/send_code`
- ç”¨äºæ³¨å†Œæ—¶å‘é€é‚®ç®±éªŒè¯ç 

2. ç”¨æˆ·æ³¨å†Œ
- POST `/api/register`
- éœ€è¦éªŒè¯ç éªŒè¯

3. ç”¨æˆ·ç™»å½•
- POST `/api/login`
- è¿”å› JWT token

### ğŸ”Œ WebSocket è¿æ¥

1. èŠå¤©æœåŠ¡
- WebSocket `/ws`
- éœ€è¦ JWT è®¤è¯

2. AI å¯¹è¯æœåŠ¡
- WebSocket `/ws/ai`
- éœ€è¦ JWT è®¤è¯

### ğŸ¤ ç¤¾äº¤åŠŸèƒ½

1. å¥½å‹ç›¸å…³
- GET `/api/contacts` - è·å–è”ç³»äººåˆ—è¡¨
- GET `/api/search/users` - æœç´¢ç”¨æˆ·
- GET `/api/search/groups` - æœç´¢ç¾¤ç»„

2. åŠ¨æ€ç›¸å…³
- GET `/api/posts` - è·å–åŠ¨æ€åˆ—è¡¨
- POST `/api/posts` - å‘å¸ƒåŠ¨æ€
- GET `/api/posts/:post_id` - è·å–åŠ¨æ€è¯¦æƒ…
- POST `/api/posts/:post_id/comments` - å‘è¡¨è¯„è®º
- POST `/api/posts/:post_id/like` - ç‚¹èµ/å–æ¶ˆç‚¹èµ

3. ç¦»çº¿æ¶ˆæ¯ç›¸å…³
- GET `/api/messages/offline` - è·å–ç¦»çº¿æ¶ˆæ¯åˆ—è¡¨
- POST `/api/messages/mark_synced` - æ ‡è®°æ¶ˆæ¯å·²åŒæ­¥
- GET `/api/messages/unread_count` - è·å–æœªè¯»æ¶ˆæ¯æ•°é‡
- DELETE `/api/messages/offline/clear` - æ¸…ç†å·²åŒæ­¥æ¶ˆæ¯

è¯¦ç»† API æ–‡æ¡£è¯·æŸ¥çœ‹ [OFFLINE_MESSAGE_API.md](./OFFLINE_MESSAGE_API.md)

## ğŸ“ ç›®å½•ç»“æ„

```
NetherLink-server/
â”œâ”€â”€ config/              # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ config.go
â”‚   â””â”€â”€ config.yaml
â”œâ”€â”€ internal/            # å†…éƒ¨åŒ…
â”‚   â”œâ”€â”€ middleware/     # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ model/          # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ server/         # æœåŠ¡å™¨å®ç°
â”‚   â””â”€â”€ service/        # ä¸šåŠ¡æœåŠ¡
â”‚       â”œâ”€â”€ message_dispatch.go      # æ¶ˆæ¯åˆ†å‘
â”‚       â”œâ”€â”€ message_persistence.go   # æ¶ˆæ¯æŒä¹…åŒ–
â”‚       â””â”€â”€ push_service.go          # æ¨é€æœåŠ¡
â”œâ”€â”€ pkg/                 # å…¬å…±åŒ…
â”‚   â”œâ”€â”€ cache/          # Redis ç¼“å­˜
â”‚   â”œâ”€â”€ database/       # æ•°æ®åº“è¿æ¥
â”‚   â”œâ”€â”€ mq/             # RabbitMQ æ¶ˆæ¯é˜Ÿåˆ—
â”‚   â””â”€â”€ utils/          # å·¥å…·å‡½æ•°
â”œâ”€â”€ migrations/          # æ•°æ®åº“è¿ç§»æ–‡ä»¶
â”œâ”€â”€ uploads/            # ä¸Šä¼ æ–‡ä»¶ç›®å½•
â”œâ”€â”€ test_offline_messages.sh  # ç¦»çº¿æ¶ˆæ¯æµ‹è¯•è„šæœ¬
â””â”€â”€ main.go             # ç¨‹åºå…¥å£
```

## ğŸ“š æ›´å¤šæ–‡æ¡£

- [æ¶ˆæ¯äº¤äº’æµç¨‹å›¾](./MESSAGE_FLOW_DIAGRAM.md) - å®Œæ•´çš„æ¶ˆæ¯å¤„ç†æµç¨‹å’Œæ¶æ„å›¾
- [WebSocket API](./WEBSOCKET_API.md) - WebSocketæ¶ˆæ¯æ ¼å¼å’ŒAPIæ–‡æ¡£
- [æ¶æ„è®¾è®¡](./ARCHITECTURE_DESIGN.md) - ç³»ç»Ÿæ¶æ„å’Œè®¾è®¡æ€è·¯
- [ç¦»çº¿æ¶ˆæ¯ API](./OFFLINE_MESSAGE_API.md) - ç¦»çº¿æ¶ˆæ¯åŠŸèƒ½è¯¦ç»†æ–‡æ¡£
- [é¡¹ç›®ç»“æ„](./PROJECT_STRUCTURE.md) - è¯¦ç»†çš„é¡¹ç›®ç»“æ„è¯´æ˜
- [éƒ¨ç½²æŒ‡å—](./DEPLOYMENT_GUIDE.md) - ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å—
- [å¿«é€Ÿå¼€å§‹](./QUICKSTART.md) - å¿«é€Ÿä¸Šæ‰‹æŒ‡å—
```
## âš ï¸ æ³¨æ„äº‹é¡¹

1. ğŸ”’ é¦–æ¬¡éƒ¨ç½²æ—¶è¯·ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„æ•æ„Ÿä¿¡æ¯
2. ğŸ›¡ï¸ å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ HTTPS
3. ğŸ“ ç¡®ä¿ä¸Šä¼ ç›®å½•å…·æœ‰é€‚å½“çš„å†™å…¥æƒé™
4. ğŸ’¾ å»ºè®®å®šæœŸå¤‡ä»½æ•°æ®åº“

## ğŸ“„ License

[MIT License](LICENSE) 