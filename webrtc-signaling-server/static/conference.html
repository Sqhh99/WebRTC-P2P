<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LiveKit 视频会议</title>
    <!-- Version: 2.2.0 - Compact layout -->
    
    <link href="bootstrap-5.3.8-dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="css/conference.css">
</head>
<body class="conference-page">
    <div class="layout">
        <!-- 左侧：我的画面 + 参会者缩略图 -->
        <section class="rail">
            <div class="rail-local">
                <div class="rail-header">
                    <span>我的画面</span>
                    <span id="miniConnectionState" class="state-pill">准备中</span>
                </div>
                <div id="localParticipant" class="rail-card local">
                    <video id="localVideo" autoplay muted playsinline></video>
                    <div class="tile-meta">
                        <span id="localName">我</span>
                        <button id="previewSpotlightBtn" title="投射到舞台">
                            <i class="bi bi-arrows-fullscreen"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="rail-remote">
                <div class="rail-header">
                    <span>会议成员</span>
                    <span id="railCount" class="count-pill">0</span>
                </div>
                <div id="videoGrid" class="rail-list"></div>
                <div id="railEmptyHint" class="rail-empty">等待其他人员加入</div>
            </div>
        </section>

        <!-- 中间舞台 -->
        <main class="stage">
            <header class="stage-bar">
                <div class="stage-info">
                    <div class="stage-room">
                        <span class="label">会议号</span>
                        <strong id="roomName">视频会议</strong>
                    </div>
                    <div class="stage-meta">
                        <span id="participantCount" class="count-pill">1</span>
                        <span id="connectionStateText" class="state-pill">准备中</span>
                        <span id="callTimer" class="state-pill muted">00:00</span>
                        <span id="screenShareIndicator" class="state-pill muted">屏幕共享</span>
                    </div>
                </div>
                <div class="stage-network">
                    <span id="connectionStatus" class="status-dot"></span>
                    <span id="networkQuality">良好</span>
                    <button id="shareBtn" class="plain-btn">
                        <i class="bi bi-share"></i> 分享链接
                    </button>
                </div>
            </header>

            <div class="stage-view" id="stageSurface">
                <video id="stageVideo" autoplay playsinline></video>
                <div id="emptyState" class="stage-empty">
                    <i class="bi bi-people"></i>
                    <p>等待其他成员加入</p>
                </div>
                <div class="stage-label">
                    <span id="stageLabel">尚未选定</span>
                    <button id="resetSpotlightBtn" class="plain-btn">
                        <i class="bi bi-bullseye"></i> 自动跟随
                    </button>
                </div>
            </div>

            <footer class="controls">
                <div class="control-buttons">
                    <button id="micBtn" class="control-btn active"><i class="bi bi-mic-fill"></i></button>
                    <button id="cameraBtn" class="control-btn active"><i class="bi bi-camera-video-fill"></i></button>
                    <button id="shareScreenBtn" class="control-btn"><i class="bi bi-display"></i></button>
                    <button id="participantsBtn" class="control-btn"><i class="bi bi-people"></i></button>
                    <button id="chatBtn" class="control-btn">
                        <i class="bi bi-chat-dots"></i>
                        <span id="chatBtnBadge" class="badge">0</span>
                    </button>
                </div>
                <div class="control-actions">
                    <button id="copyStageBtn" class="plain-btn"><i class="bi bi-link-45deg"></i> 复制链接</button>
                    <button id="leaveBtn" class="control-btn danger"><i class="bi bi-telephone-x"></i></button>
                </div>
            </footer>
        </main>

        <!-- 右侧浮动面板 -->
        <aside id="utilityPanel" class="utility-panel">
            <div class="panel-tabs">
                <button id="panelParticipantsTab" class="panel-tab active" data-target="participants">
                    <i class="bi bi-people"></i>
                </button>
                <button id="panelChatTab" class="panel-tab" data-target="chat">
                    <i class="bi bi-chat-text"></i>
                </button>
            </div>
            <div class="panel-content">
                <div id="panelParticipants" class="panel-pane active">
                    <header>
                        <h4>参会者</h4>
                        <span id="sidebarParticipantCount">0</span>
                    </header>
                    <div id="participantsList" class="scroll-area"></div>
                </div>
                <div id="panelChat" class="panel-pane">
                    <header>
                        <h4>会议聊天</h4>
                        <button id="collapseChatBtn" class="plain-btn small"><i class="bi bi-x"></i></button>
                    </header>
                    <div id="chatMessages" class="scroll-area chat"></div>
                    <div id="typingIndicator" class="typing-indicator"></div>
                    <div class="chat-composer">
                        <textarea id="chatInput" placeholder="输入消息，Enter发送 / Shift+Enter换行"></textarea>
                        <div class="composer-actions">
                            <span>Enter 发送</span>
                            <button id="chatSendBtn" class="plain-btn"><i class="bi bi-send"></i> 发送</button>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <p id="loadingText">正在连接会议...</p>
        </div>
    </div>

    <div id="toastContainer" class="toast-container"></div>

    <script src="livekit/livekit-client.umd.min.js"></script>
    <script src="bootstrap-5.3.8-dist/js/bootstrap.bundle.min.js"></script>
    <script>
        console.log('🔄 强制加载最新脚本，时间戳:', Date.now());
    </script>
    <script src="js/conference-manager.js?v=20251116180000"></script>
    <script src="js/conference-ui.js?v=20251116180000"></script>
    <script src="js/conference-app.js?v=20251116180000"></script>
</body>
</html>
